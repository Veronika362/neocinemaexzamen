<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–§–∏–ª—å–º | NeoCinema</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(ellipse at center, #0a0a1a 0%, #000000 100%);
      color: white;
      margin: 0;
      padding: 0;
    }
    .stars {
      background: url('https://www.transparenttextures.com/patterns/stardust.png');
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      opacity: 0.3;
    }
    .container {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 80px auto 50px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(0, 0, 0, 0.6);
      box-shadow: 0 0 40px rgba(0, 255, 255, 0.5);
    }
    h1 {
      font-size: 2.5rem;
      color: cyan;
      text-shadow: 0 0 10px cyan;
      margin-bottom: 1rem;
    }
    .poster {
      width: 300px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
      transition: transform 0.3s;
    }
    .poster:hover {
      transform: scale(1.03);
    }
    table {
      margin-top: 1rem;
      width: 100%;
      border-collapse: collapse;
    }
    td, th {
      padding: 12px;
      font-size: 1rem;
      border-bottom: 1px solid rgba(0, 255, 255, 0.3);
    }
    th {
      color: #00ffff;
      text-align: left;
      width: 150px;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: 4px solid cyan;
      border-radius: 15px;
      margin-top: 2rem;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    }
    .btns {
      margin-top: 20px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .btn {
      background: cyan;
      color: #000;
      font-weight: bold;
      padding: 12px 24px;
      border-radius: 10px;
      text-decoration: none;
      transition: 0.3s;
      box-shadow: 0 0 10px cyan;
      border: none;
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
    }
    .btn:hover {
      background: #00ffff;
      box-shadow: 0 0 20px #00ffff;
    }
    .btn.active {
      background-color: #ff00ff;
      box-shadow: 0 0 15px #ff00ff;
    }
    .btn.active:hover {
      background-color: #cc00cc;
      box-shadow: 0 0 20px #ff00ff;
    }
    .btn-favorite.active {
      background-color: #ffff00;
      color: #000;
      box-shadow: 0 0 15px #ffff00;
    }
    .btn-watch-later.active {
      background-color: #00ff00;
      color: #000;
      box-shadow: 0 0 15px #00ff00;
    }
    .back-link {
      display: inline-block;
      margin-top: 2rem;
      color: #aaa;
      text-decoration: none;
      transition: 0.3s;
    }
    .back-link:hover {
      color: cyan;
      text-shadow: 0 0 10px cyan;
    }
    .description {
      margin-top: 20px;
      line-height: 1.6;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #1a1a2e;
      border: 1px solid #0ff;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 0 15px #0ff;
      z-index: 1000;
      transform: translateX(200%);
      transition: transform 0.3s ease;
    }
    .notification.show {
      transform: translateX(0);
    }
    @media (max-width: 768px) {
      .container {
        margin: 70px 15px 30px;
        padding: 20px;
      }
      .poster {
        width: 100%;
      }
      .btns {
        flex-direction: column;
        gap: 10px;
      }
      iframe {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <div class="stars"></div>
  <div id="notification" class="notification hidden">
    <p id="notificationText"></p>
  </div>

  <div class="container">
    <h1 id="title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>

    <div style="display: flex; flex-wrap: wrap; gap: 30px;">
      <img id="poster" src="" alt="–ü–æ—Å—Ç–µ—Ä" class="poster" />

      <div style="flex: 1;">
        <table>
          <tr><th>–ñ–∞–Ω—Ä</th><td id="genre">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          <tr><th>–ì–æ–¥</th><td id="year">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          <tr><th>–†–µ–∂–∏—Å—Å—ë—Ä</th><td id="director">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          <tr><th>–†–µ–π—Ç–∏–Ω–≥</th><td id="rating">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          <tr><th>–û–ø–∏—Å–∞–Ω–∏–µ</th><td id="overview" class="description">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </table>

        <div class="btns">
          <button onclick="trackView()" class="btn">‚ñ∂ –°–º–æ—Ç—Ä–µ—Ç—å</button>
          <button onclick="toggleFavorite()" class="btn btn-favorite">‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
          <button onclick="toggleWatchLater()" class="btn btn-watch-later">‚è≥ –°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ</button>
        </div>
      </div>
    </div>

    <h2 style="margin-top: 3rem; color: cyan;">–¢—Ä–µ–π–ª–µ—Ä</h2>
    <iframe id="trailer" src="" frameborder="0" allowfullscreen></iframe>

    <a href="index.html" class="back-link">&larr; –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
  </div>

  <script>
    const API_KEY = '552bd05089e570f9506a70919db070e7'; 
    const movieId = new URLSearchParams(window.location.search).get('id');
    let movieData = {};

    function showNotification(message) {
      const notification = document.getElementById("notification");
      const notificationText = document.getElementById("notificationText");
      
      notificationText.textContent = message;
      notification.classList.remove("hidden");
      notification.classList.add("show");
      
      setTimeout(() => {
        notification.classList.remove("show");
        setTimeout(() => notification.classList.add("hidden"), 300);
      }, 3000);
    }

    function updateButtonStates() {
      const favorites = JSON.parse(localStorage.getItem("neoFavorites")) || [];
      const watchLater = JSON.parse(localStorage.getItem("neoWatchLater")) || [];
      
      const favBtn = document.querySelector('.btn-favorite');
      const watchBtn = document.querySelector('.btn-watch-later');
      
      if (favorites.includes(movieData.title)) {
        favBtn.textContent = '‚òÖ –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ';
        favBtn.classList.add('active');
      } else {
        favBtn.textContent = '‚≠ê –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
        favBtn.classList.remove('active');
      }
      
      if (watchLater.includes(movieData.title)) {
        watchBtn.textContent = '‚úï –£–¥–∞–ª–∏—Ç—å –∏–∑ "–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ"';
        watchBtn.classList.add('active');
      } else {
        watchBtn.textContent = '‚è≥ –°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ';
        watchBtn.classList.remove('active');
      }
    }

    function toggleFavorite() {
      let favorites = JSON.parse(localStorage.getItem("neoFavorites")) || [];
      const index = favorites.indexOf(movieData.title);
      
      if (index === -1) {
        favorites.push(movieData.title);
        showNotification("‚≠ê –§–∏–ª—å–º –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!");
      } else {
        favorites.splice(index, 1);
        showNotification("–§–∏–ª—å–º —É–¥–∞–ª—ë–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ");
      }
      
      localStorage.setItem("neoFavorites", JSON.stringify(favorites));
      updateButtonStates();
    }

    function toggleWatchLater() {
      let watchLater = JSON.parse(localStorage.getItem("neoWatchLater")) || [];
      const index = watchLater.indexOf(movieData.title);
      
      if (index === -1) {
        watchLater.push(movieData.title);
        showNotification("‚è≥ –§–∏–ª—å–º –¥–æ–±–∞–≤–ª–µ–Ω –≤ '–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ'!");
      } else {
        watchLater.splice(index, 1);
        showNotification("–§–∏–ª—å–º —É–¥–∞–ª—ë–Ω –∏–∑ '–°–º–æ—Ç—Ä–µ—Ç—å –ø–æ–∑–∂–µ'");
      }
      
      localStorage.setItem("neoWatchLater", JSON.stringify(watchLater));
      updateButtonStates();
    }

    function trackView() {
      if (!movieData.id) return;

      let viewStats = JSON.parse(localStorage.getItem("neoViewStats")) || {};
      const movieTitle = movieData.title;
      const moviePoster = `https://image.tmdb.org/t/p/w500${movieData.poster_path}`;

      if (!viewStats[movieData.id]) {
        viewStats[movieData.id] = { title: movieTitle, poster: moviePoster, count: 1 };
      } else {
        viewStats[movieData.id].count += 1;
      }

      localStorage.setItem("neoViewStats", JSON.stringify(viewStats));
      showNotification("üé¨ –§–∏–ª—å–º –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤!");

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—á–∏–≤–æ–∫
      checkAchievements(viewStats);
    }

    function checkAchievements(viewStats) {
      const totalViews = Object.values(viewStats).reduce((sum, film) => sum + film.count, 0);
      const achievements = [];
      
      if (totalViews === 1) achievements.push("üé¨ –ü–µ—Ä–≤—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä!");
      if (totalViews === 5) achievements.push("üìΩ –ö–∏–Ω–æ–º–∞–Ω: 5 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤");
      if (totalViews === 10) achievements.push("üçø –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: 10 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤");
      if (totalViews === 20) achievements.push("üöÄ –ö–∏–Ω–æ–≤—Å–µ–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–π–¥–µ–Ω–∞!");

      if (achievements.length > 0) {
        showNotification("üèÜ –ü–æ–ª—É—á–µ–Ω–∞ –∞—á–∏–≤–∫–∞: " + achievements[0]);
      }
    }

    function displayMovieData() {
      document.getElementById('title').textContent = movieData.title;
      document.getElementById('poster').src = `https://image.tmdb.org/t/p/w500${movieData.poster_path}`;
      document.getElementById('poster').alt = movieData.title;
      document.getElementById('genre').textContent = movieData.genres.map(g => g.name).join(', ');
      document.getElementById('year').textContent = movieData.release_date.split('-')[0];
      document.getElementById('rating').textContent = movieData.vote_average.toFixed(1);
      document.getElementById('overview').textContent = movieData.overview || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
      updateButtonStates();
    }

    async function loadMovie() {
      if (!movieId) {
        document.getElementById('title').textContent = '–§–∏–ª—å–º –Ω–µ –≤—ã–±—Ä–∞–Ω';
        document.querySelector('.container').innerHTML += `
          <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º –Ω–∞ <a href="index.html" style="color: cyan;">–≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</a></p>
        `;
        return;
      }

      try {
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        const movieResponse = await fetch(
          `https://api.themoviedb.org/3/movie/${movieId}?api_key=${API_KEY}&language=ru`
        );
        
        if (!movieResponse.ok) {
          throw new Error(`HTTP error! status: ${movieResponse.status}`);
        }
        
        movieData = await movieResponse.json();
        displayMovieData();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–π–ª–µ—Ä–∞
        const videosResponse = await fetch(
          `https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${API_KEY}&language=ru`
        );
        const videosData = await videosResponse.json();
        
        const trailer = videosData.results.find(v => v.type === 'Trailer' && v.site === 'YouTube');
        if (trailer) {
          document.getElementById('trailer').src = `https://www.youtube.com/embed/${trailer.key}`;
        } else {
          document.querySelector('h2').textContent = '–¢—Ä–µ–π–ª–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω';
          document.getElementById('trailer').style.display = 'none';
        }
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        document.getElementById('title').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
        showNotification('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
      }
    }

    document.addEventListener('DOMContentLoaded', loadMovie);
  </script>
</body>
</html>